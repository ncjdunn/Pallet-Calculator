<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>John's Better Pallet Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="app-icon.png">
  <meta name="theme-color" content="#121212">
  <style>
    body { margin:0; min-height:100vh; display:flex; justify-content:center; align-items:flex-start; padding-top:20px; background:#121212; color:#e0e0e0; font-family:'Segoe UI',sans-serif; overflow-y:auto; }
    .bezel { background:url('wood_grain_texture.jpg') no-repeat center center; background-size:cover; padding:16px; border-radius:16px; box-shadow:0 0 12px rgba(0,0,0,0.5); width:100%; max-width:360px; }
    .calculator { background:#1e1e1e; border-radius:8px; box-shadow:inset 0 2px 8px rgba(0,0,0,0.7); padding:24px; text-align:center; }
    .checkbox-row { display:flex; gap:8px; margin-bottom:12px; justify-content:space-evenly; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    label { display:flex; flex-direction:column; align-items:flex-start; font-size:14px; color:#cfcfcf; width:100%; }
    input[type="number"], select { margin-top:6px; padding:8px; font-size:16px; border:1px solid #444; border-radius:6px; background:#2c2c2c; color:#e0e0e0; width:100%; }
    input[type="checkbox"] { margin:0 4px 0 0; transform:scale(1.2); }
    button { margin-top:20px; padding:12px; font-size:18px; width:100%; border:none; border-radius:6px; background:#bb86fc; color:#121212; cursor:pointer; font-weight:bold; }
    button:hover { background:#9a65d1; }
    .results { margin-top:24px; background:#2c2c2c; padding:12px; border-radius:6px; min-height:240px; font-size:16px; white-space:pre-wrap; text-align:left; color:#e0e0e0; }
  </style>
</head>
<body>
  <div class="bezel">
    <div class="calculator">
      <h1>John's Better Pallet Calculator <img src="logo.png" alt="Logo" style="height:40px; vertical-align:middle; margin-left:8px;"></h1>
      <div id="extensionNote" style="display:none; background:yellow; color:red; padding:6px; border-radius:4px; margin-bottom:12px;">
        Note: 1 or 2 2×4 extension will likely be needed.
      </div>
      <div class="checkbox-row">
        <label>UV<input type="checkbox" id="uvProduct"></label>
        <label>Placeholder1<input type="checkbox" id="placeholder1"></label>
        <label>Placeholder2<input type="checkbox" id="placeholder2"></label>
      </div>
      <div class="grid">
        <label>Liner Length (ft)<input type="number" id="length"></label>
        <label>Diameter (in)<input type="number" id="diameter"></label>
        <label>Gauge (mm)<input type="number" id="gauge"></label>
        <label>Pallet Length<select id="manualLength">
          <option value="">Auto</option>
          <option>4</option><option>7</option><option>9</option><option>12</option><option>15</option>
          <option>20</option><option>24</option><option>30</option><option>34</option><option>35</option>
          <option>36</option><option>40</option><option>42</option><option>43</option><option>45</option>
          <option>48</option><option>53</option><option>58</option><option>60</option><option>65</option>
          <option>70</option><option>72</option>
        </select></label>
        <label>Pallet Width<select id="palletWidth">
          <option value="auto" selected>Auto</option>
          <option>4</option><option>7</option><option>7.5</option><option>8</option><option>9</option>
          <option>12</option><option>15</option><option>20</option>
        </select></label>
        <label>Direction<select id="direction">
          <option value="longways">Longways</option>
          <option value="sideways">Sideways</option>
        </select></label>
        <label>Manual Stacks<select id="manualStacks">
          <option value="">Auto</option>
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
          <option>6</option><option>7</option><option>8</option><option>9</option>
        </select></label>
        <label>Customer<select id="customer">
          <option value="">None</option>
          <option value="corby">Corby Stock</option>
          <option value="uwfl">UW FL</option>
          <option value="gulf">Gulf Coast</option>
          <option value="jetjack">Jet Jack</option>
          <option value="leak">Leak Eliminators</option>
          <option value="minchem">Min Chem</option>
          <option value="municipal">Municipal Pipe</option>
          <option value="suncoast">Suncoast</option>
        </select></label>
      </div>
      <button id="calculateBtn">Calculate</button>
      <label style="margin-top:12px; text-align:left;">
        Add a 2×4
        <select id="widthExtension">
          <option value="0">None</option>
          <option value="2">1-2x4</option>
          <option value="4">2-2x4's</option>
        </select>
      </label><label style="margin-top:12px; display:flex; align-items:center;">
    Half & Half Stacking<input type="checkbox" id="halfStack" style="margin-left:4px;">
  </label>
  <div id="results" class="results"></div>
  <a href="error.html" style="display:block; margin-top:12px; color:#bb86fc;">Report an Error</a>
</div>

  </div>
  <script>
    const palletLengths=[4,7,9,12,15,20,24,30,34,35,36,40,42,43,45,48,53,58,60,65,70,72];
    const inputs=['uvProduct','length','diameter','gauge','manualLength','palletWidth','direction','manualStacks','customer','widthExtension','halfStack'];
    const MAX_HEIGHT_IN=73;function calculateLayflatWidth(diameter,gauge,uv){
  const factor=uv?0.94:0.92;
  const subTerm=uv?gauge*0.00475:(0.01*gauge*12);
  const gaugeOffsetIn=(gauge*2)/25.4;
  return((Math.PI*diameter)/2)*factor - subTerm + gaugeOffsetIn;
}

function formatHeight(inches){const ft=Math.floor(inches/12);const inch=(inches-ft*12).toFixed(1);return`${ft} ft ${inch} in`;}
function formatResult(lines){return lines.join("\n");}

inputs.forEach(id=>{const el=document.getElementById(id);el.addEventListener('input',calculate);el.addEventListener('change',calculate);});
document.getElementById('calculateBtn').addEventListener('click',calculate);
// toggle extension note when extension dropdown changes
const extEl = document.getElementById('widthExtension');
extEl.addEventListener('change', () => {
  document.getElementById('extensionNote').style.display = extEl.value !== '0' ? 'block' : 'none';
});


function calculate() {
  // hide or show extension note at start of calculation
  const extNote = document.getElementById('extensionNote');
  extNote.style.display = document.getElementById('widthExtension').value !== '0' ? 'block' : 'none';
  const L=parseFloat(document.getElementById('length').value);
  const D=parseFloat(document.getElementById('diameter').value);
  const G=parseFloat(document.getElementById('gauge').value);
  const results=document.getElementById('results'); if(!L||!D||!G){results.textContent='Please fill in all fields.';return;}
  const uv=document.getElementById('uvProduct').checked;
  const ml=document.getElementById('manualLength').value;
  const pwVal=document.getElementById('palletWidth').value;
  const dir=document.getElementById('direction').value;
  const ms=document.getElementById('manualStacks').value;
  const cust=document.getElementById('customer').value||'None';
  const extSelect=document.getElementById('widthExtension');
  const half=document.getElementById('halfStack').checked;

  // Auto and manual modes share evaluation
  function evaluateCombo(w,pl,extIn){
    const stackW=calculateLayflatWidth(D,G,uv);
    const stacks=ms?parseInt(ms,10):(dir==='sideways'?Math.floor((pl*12+extIn)/stackW):Math.floor((w*12+extIn)/stackW));
    if(stacks<=0) return null;
    const lenPer=L/stacks; const folds=Math.floor(lenPer/(2*pl));
    const perFold=G*(uv?0.325:0.3034);
    const totalIn=folds*perFold+10;
    const cap=(w===4&&pl===7?43:MAX_HEIGHT_IN);
    if(totalIn>cap) return null;
    const freeW=Math.abs((dir==='sideways'?pl*12:w*12)+extIn-stacks*stackW);
    const takedowns=[];for(let i=1;i<stacks;i++){let val=lenPer*i;if(half)val/=2;takedowns.push(Math.round(val));}
    return {w,pl,stacks,lenPer,folds,stackW,totalIn,freeW,takedowns};
  }

  // Manual override
  if(ml||pwVal!=='auto'||ms){
    const l=ml?parseInt(ml,10):null; const pw=pwVal!=='auto'?parseFloat(pwVal):7;
    let w=pw,pl=l||pw; if((l===4&&pw===7)||(l===7&&pw===4)){w=4;pl=7;}
    // test ext 0,2,4, prefer smallest ext giving max stacks
    let best=null;for(const extIn of [0,2,4]){const res=evaluateCombo(w,pl,extIn);if(res&&( (!best)||(res.stacks>best.stacks)||(res.stacks===best.stacks&&extIn<best.ext))){best={...res,ext:extIn};}} 
    if(!best){results.textContent='No stacks fit.';return;} extSelect.value = best.ext;
    // show/hide extension note
    document.getElementById('extensionNote').style.display = best.ext !== 0 && best.ext !== '0' ? 'block' : 'none';
    // display
    results.textContent=formatResult([
      `Pallet: ${best.w}×${best.pl} ft`,
      `Stacks: ${best.stacks}`,
      `Customer: ${cust}`,
      `Length/Stack: ${best.lenPer.toFixed(2)} ft`,
      `Folds/Stack: ${best.folds}`,
      `Stack Width: ${best.stackW.toFixed(2)} in`,
      `Total Height: ${formatHeight(best.totalIn)}`,
      `Free Pallet Width: ${best.freeW.toFixed(2)} in`,
      `Take Downs: ${best.takedowns.join(', ')} ft`
    ]);
    return;
  }

  // Auto-mode
  for(const w of [4,7,8]){
    for(const pl of (w===4?[7]:palletLengths)){
      if(w===7&&pl===4) continue;
      let best=null;
      for(const extIn of [0,2,4]){
        const res=evaluateCombo(w,pl,extIn);
        if(res&&( (!best)||(res.stacks>best.stacks)||(res.stacks===best.stacks&&extIn<best.ext))){best={...res,ext:extIn};}
      }
      if(best){document.getElementById('widthExtension').value=best.ext;
        // toggle extension note for auto mode
        document.getElementById('extensionNote').style.display = best.ext !== 0 && best.ext !== '0' ? 'block' : 'none';
        results.textContent=formatResult([
          `Pallet: ${best.w}×${best.pl} ft`,
          `Stacks: ${best.stacks}`,
          `Customer: ${cust}`,
          `Length/Stack: ${best.lenPer.toFixed(2)} ft`,
          `Folds/Stack: ${best.folds}`,
          `Stack Width: ${best.stackW.toFixed(2)} in`,
          `Total Height: ${formatHeight(best.totalIn)}`,
          `Free Pallet Width: ${best.freeW.toFixed(2)} in`,
          `Take Downs: ${best.takedowns.join(', ')} ft`
        ]);
        return;
      }
    }
  }
  results.textContent='No pallet fits under height restrictions.';
}

  </script>
</body>
</html>
